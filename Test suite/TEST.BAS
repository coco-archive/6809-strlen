1 GOTO 10
2 I=I+1:IFPEEK(I)THEN2
3 RETURN
4 IFINKEY$=""THEN4
5 RETURN
6 S$=INKEY$:IFS$=""THEN6
7 RETURN
10 PCLEAR 1
20 CLEAR 255, &H5FFF
30 CLS
40 REM TIME-CRITICAL CODE
50 REM  ABOVE
60 REM
100 REM     TEST.BAS
110 REM
120 REM A PROGRAM TO TEST
130 REM    6809-STRLEN
140 REM
200 REM BY RICHARD JOHN
210 REM  FOSTER CAVELL
220 REM    (C) 2017
230 REM
300 REM HTTPS://GITHUB.COM/
310 REM   RICHARDCAVELL/
320 REM     6809-STRLEN
330 REM
400 REM THIS PROGRAM IS FOR
410 REM AN EMULATED TRS-80
420 REM  COLOR COMPUTER 2
430 REM  RUNNING IN XROAR
440 REM       OR MAME
450 REM
500 REM     IT NEEDS
510 REM AT LEAST 16K AND
520 REM   AN EMULATED
530 REM    DISK DRIVE
540 REM
600 US = &H6000
800 DEFUSR1 = US + &H100
810 DEFUSR2 = US + &H180
900 PS = US + &H200
950 I = 0
1000 A$ = "HELLO, WORLD!"
1010 B$ = "1234567890"
1020 C$ = "<>!@$%"
1030 D$ = ""
1050 E$ = ""
1060 FOR I = 193 TO 220
1070 E$ = E$ + CHR$(I)
1080 NEXT I
1100 F$ = "THIS IS A LONG STRING.  IT IS TOO LONG TO FIT ON ONE LINE."
1150 S$ = ""
1160 X$ = ""
1200 ZA = 1024
1210 ZB = 3000
1250 Z = 0
1300 FA$ = "STRLEN"
1310 FB$ = "NESTRLEN"
1320 FC$ = "HELPER1"
1330 FD$ = "HELPER2"
1350 FI$ = ""
1400 A = 0
1450 CO = 0
1460 CS = 0
1500 LB = 0
1510 LA = 0
1600 LN$ = "E"
2000 CLS
2100 SE$ = "6809-STRLEN TEST SUITE"
2110 SD$ = "6809-STRLEN TESTLAUF"
2120 GOSUB 5200
2150 SE$ = "BY RICHARD CAVELL"
2160 SD$ = "VON RICHARD CAVELL"
2170 GOSUB 5200
2180 PRINT
2200 SE$ = "HTTPS://GITHUB.COM/"
2210 SD$ = SE$
2220 GOSUB 5200
2250 SE$ = "RICHARDCAVELL/6809-STRLEN"
2260 SD$ = SE$
2270 GOSUB 5200
2280 PRINT
2300 SE$ = "PRESS E FOR ENGLISH"
2310 SD$ = SE$
2320 GOSUB 5200
2350 SE$ = "DRUCKEN SIE D FUR DEUTSCH"
2360 SD$ = SE$
2370 GOSUB 5200
2380 PRINT
2400 SE$ = "PLEASE ENSURE THAT THE TEST"
2410 SD$ = "BITTE STELLEN SIE SICHER,"
2420 GOSUB 5200
2450 SE$ = "SUITE DISK IS IN THE DRIVE"
2460 SD$ = "DASS DIE TESTFOLGEN-DISK"
2470 GOSUB 5200
2500 SE$ = ""
2510 SD$ = "IM LAUFWERK IST"
2520 GOSUB 5200
2530 IF LN$ = "D" THEN PRINT
2600 SE$ = "PRESS ANY KEY TO START"
2610 SD$ = "DRUCKEN SIE EINE BELIEBIGE"
2620 GOSUB 5200
2650 SE$ = ""
2660 SD$ = "TASTE UM ZU STARTEN"
2670 GOSUB 5200
2700 SE$ = "(A FOR AUTORUN)"
2710 SD$ = "(A FUR AUTOMATISCHE WIEDERGABE)"
2720 GOSUB 5500
2750 GOSUB 6700
2800 CLS
2810 PRINT
2820 FI$ = FA$ : GOSUB 7000
2830 FI$ = FB$ : GOSUB 7000
2840 FI$ = FC$ : GOSUB 7000
2850 FI$ = FD$ : GOSUB 7000
3000 X$ = A$ : GOSUB 10000
3010 X$ = B$ : GOSUB 10000
3020 X$ = C$ : GOSUB 10000
3030 X$ = D$ : GOSUB 10000
3040 X$ = E$ : GOSUB 10000
3050 X$ = F$ : GOSUB 10000
3200 Z = ZA : GOSUB 20000
3210 GOSUB 6000
3250 Z = ZB : GOSUB 20000
3400 CO = CO * 2
3410 SE$ = "TOTAL SCORE :"
3420 SD$ = "PUNKTE INSGESAMT :"
3430 GOSUB 5000
3450 PRINT CS;
3460 SE$ = "OUT OF"
3470 SD$ = "VON"
3480 GOSUB 5100
3490 PRINT CO
3500 PRINT "  (";
3510 PRINT INT((CS/CO)*100 + 0.5);
3520 PRINT "% )"
3530 SE$ = "...FINISHED!"
3540 SD$ = "...FERTIGGESTELLT!"
3550 GOSUB 5000
3600 END
5000 REM PRINT SE$/SD$
5010 REM  BASED ON LANGUAGE
5020 GOSUB 5700
5030 PRINT S$
5040 RETURN
5100 REM PRINT SE$/SD$
5110 REM  WITH NO NEWLINE
5120 GOSUB 5700
5130 PRINT S$;
5140 RETURN
5200 REM PRINT SE$/SD$,
5210 REM  CENTRE-JUSTIFIED
5220 GOSUB 5700
5300 GOSUB 5800
5310 PRINT S$
5320 RETURN
5500 REM PRINT SE$/SD$,
5510 REM  CENTRE-JUSTIFIED
5520 REM  WITH NO NEWLINE
5530 GOSUB 5700
5600 GOSUB 5800
5610 PRINT S$;
5620 RETURN
5700 REM CHOOSE S$
5710 REM BASED ON LANGUAGE
5720 IF LN$ = "E" THEN S$ = SE$
5730 IF LN$ = "D" THEN S$ = SD$
5740 RETURN
5800 I=(32-LEN(S$))/2:IFI>=1THENPRINTSTRING$(INT(I),32);
5810 RETURN
6000 REM IF AUTORUN IS NOT
6010 REM  ON, ASK FOR
6020 REM  KEYPRESS, THEN
6030 REM  WAIT FOR IT
6100 IF A = 1 THEN RETURN
6150 SE$ = "PRESS ANY KEY TO CONTINUE"
6160 SD$ = "DRUCKEN SIE EINE BELIEBIGE"
6170 GOSUB 5200
6180 SE$ = ""
6190 SD$ = "TASTE UM FORTZUFAHREN"
6200 IF LN$ <> "E" THEN GOSUB 5500
6210 GOTO 6500
6500 REM WAIT FOR KEYPRESS
6510 REM  IGNORE THE KEY
6600 GOTO 4
6700 REM WAIT FOR KEYPRESS
6710 REM  INTERPRET RESPONSE
6800 GOSUB 6
6810 IF S$ = "A" THEN A = 1
6820 IF S$ = "E" THEN GOTO 6900
6830 IF S$ = "D" THEN GOTO 6920
6850 RETURN
6900 LN$ = "E"
6910 GOTO 2000
6920 LN$ = "D"
6930 GOTO 2000
7000 REM LOAD MACHINE
7010 REM  LANGUAGE ROUTINE
7020 REM  NAMED IN FI$
7100 PRINT "   ";
7110 PRINT "LOADING "; FI$;
7150 FOR I = LEN(FI$) TO 10
7160 PRINT ".";
7170 NEXT I
7200 LOADM FI$
7210 SE$ = " DONE!"
7220 SD$ = " FERTIG!"
7230 GOSUB 5000
7240 RETURN
8000 REM COUNT THE TESTS
8010 CO = CO + 1
8020 SE$ = "TEST #" + STR$(CO)
8030 SD$ = "TEST #" + STR$(CO)
8040 GOSUB 5200
8050 RETURN
9000 REM MEASURE STRING
9010 REM LENGTH USING BASIC
9020 I = PS - 1
9030 GOSUB 2
9040 LB = I - PS
9050 RETURN
9200 REM MEASURE STRING
9210 REM LENGTH USING STRLEN
9220 LA = USR1(0)
9230 IF LA<>&HFFFF THEN RETURN
9240 SE$ = "ERROR!"
9250 SD$ = "FEHLER!"
9280 GOSUB 5000
9290 PRINT
9300 SE$ = "NO-END ERROR DETECTED"
9310 SD$ = "ENDLOSFEHLER IM"
9350 GOSUB 5000
9360 SE$ = "IN STRING"
9370 SD$ = "STRING FESTGESTELLT"
9380 GOSUB 5000
9390 END
9400 REM MEASURE STRING
9410 REM LENGTH USING NESTRLEN
9420 LA = USR1(1)
9430 IF LA<>&HFFFF THEN RETURN
9500 SE$ = "ERROR!"
9510 SD$ = "FEHLER!"
9550 GOSUB 5000
9560 PRINT
9570 SE$ = "NO-END ERROR RETURNED"
9580 SD$ = "ENDLOSFEHLER WURDE VON"
9600 GOSUB 5000
9610 SE$ = "BY NESTRLEN"
9620 SD$ = "NESTRLEN WIEDERGEGEBEN"
9650 GOSUB 5000
9660 SE$ = "THIS SHOULD NOT BE POSSIBLE"
9670 SD$ = "DIES SOLLTE NICHT MOGLICH SEIN"
9680 GOSUB 5000
9700 END
10000 REM TEST LENGTH OF X$
10010 CLS
10020 GOSUB 8000
10030 PRINT
10040 SE$ = "THE STRING IS : "
10050 SD$ = "BLAH :"
10080 GOSUB 5000
10090 PRINT " ";CHR$(34);
10100 PRINT X$;CHR$(34)
10110 PRINT
10120 SE$ = "CONSTRUCTING"
10130 SD$ = "KONSTRUIERE"
10150 GOSUB 5100
10200 SE$ = " STRING..."
10210 SD$ = " STRING..."
10220 GOSUB 5100
10290 LB = LEN(X$)
10300 IF LB < 1 THEN GOTO 10400
10310 FOR I = 0 TO (LB - 1)
10320 POKE (PS + I), ASC(MID$(X$,I + 1,1))
10330 NEXT I
10400 POKE (PS + LB), 0
10410 SE$ = "DONE!"
10415 SD$ = "FERTIG!"
10420 GOSUB 5000
10430 PRINT
10500 SE$ = "THE MEASURED"
10505 SD$ = "DIE GEMESSENE"
10510 GOSUB 5100
10520 SE$ = " LENGTH IS : "
10525 SD$ = " LANGE IST : "
10530 GOSUB 5000
10540 SE$ = " (BASIC)   "
10545 SD$ = SE$
10550 GOSUB 5100
10600 GOSUB 9000
10610 PRINT LB
10700 SE$ = " (STRLEN)  "
10705 SD$ = SE$
10710 GOSUB 5100
10720 GOSUB 9200
10730 PRINT LA;
10800 IF LA <> LB THEN GOTO 11500
11000 SE$ = "(PASS)"
11005 SD$ = SE$
11010 GOSUB 5000
11020 CS = CS + 1
11030 GOTO 12000
11500 SE$ = "(FAIL!)"
11505 SD$ = SE$
11510 GOSUB 5000
12000 SE$ = " (NESTRLEN)"
12005 SD$ = SE$
12010 GOSUB 5100
12020 GOSUB 9400
12030 PRINT LA;
12040 IF LA <> LB THEN GOTO 12500
12050 SE$ = "(PASS)"
12055 SD$ = SE$
12060 GOSUB 5000
12070 CS = CS + 1
12080 GOTO 13000
12500 SE$ = "(FAIL!)"
12505 SD$ = SE$
12510 GOSUB 5000
13000 PRINT
13010 GOSUB 6000
13020 RETURN
20000 REM VERY LONG
20010 REM  STRING TEST
20020 REM  LENGTH IS IN Z
20050 CLS
20100 GOSUB 8000
20150 SE$ = "VERY LONG STRING TEST"
20160 SD$ = "SEHR LANGER STRING TEST"
20170 GOSUB 5200
20200 SE$ = "(BE PATIENT!)"
20210 SD$ = "(HABEN SIE GEDULD!)"
20220 GOSUB 5200
20230 PRINT
20300 SE$ = "INTENDED"
20310 SD$ = "VORGESEHENE"
20320 GOSUB 5100
20330 SE$ = " LENGTH :"
20340 SD$ = " LANGE :"
20350 GOSUB 5100
20360 PRINT Z
20370 PRINT
20400 SE$ = "CONSTRUCTING"
20410 SD$ = "KONSTRUIERE"
20420 GOSUB 5100
20430 SE$ = " STRING..."
20440 SD$ = " STRING..."
20450 GOSUB 5100
20500 I = USR2(Z)
20510 SE$ = "DONE!"
20520 SD$ = "FERTIG!"
20530 GOSUB 5000
20540 PRINT
20600 SE$ = "THE MEASURED"
20610 SD$ = "DIE GEMESSENE"
20620 GOSUB 5100
20630 SE$ = " LENGTH IS : "
20640 SD$ = " LANGE IST : "
20650 GOSUB 5000
20660 PRINT " (BASIC)   ";
20700 GOSUB 9000
20710 PRINT LB
20720 PRINT " (STRLEN)  ";
20730 GOSUB 9200
20700 PRINT LA;
20800 IF LB <> Z THEN GOTO 22000
20810 IF LA <> Z THEN GOTO 22000
20900 SE$ = "(PASS)"
20910 SD$ = SE$
20920 GOSUB 5000
20930 CS = CS + 1
21000 PRINT " (NESTRLEN)";
21010 GOSUB 9400
21020 PRINT LA;
21400 IF LB <> Z THEN GOTO 23000
21410 IF LA <> Z THEN GOTO 23000
21420 SE$ = "(PASS)"
21430 SD$ = SE$
21440 GOSUB 5000
21450 CS = CS + 1
21500 PRINT
21550 RETURN
22000 SE$ = "(FAIL!)"
22010 SD$ = SE$
22020 GOSUB 5000
22100 GOTO 21000
23000 SE$ = "(FAIL!)"
23010 SD$ = SE$
23020 GOSUB 5000
23030 GOTO 21500
