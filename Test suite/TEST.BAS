10 REM       TEST.BAS
20 REM
30 REM  A PROGRAM TO TEST
40 REM       STRLEN.S
50 REM
60 REM   BY RICHARD JOHN
70 REM    FOSTER CAVELL
80 REM      (C) 2017
90 REM
100 REM THIS PROGRAM NEEDS
110 REM  AT LEAST 16K AND
120 REM    A DISK DRIVE
130 REM
150 PCLEAR 1
160 CLEAR 200, &H2FF0
190 REM
200 LET PA = &H2FFC
210 LET PB = &H2FFE
220 LET PL = &H2FFE
230 LET PM = &H3000
240 LET PN = &H3100
250 LET PP = &H317C
260 LET PQ = &H317E
270 LET PR = &H3180
280 LET PS = &H3200
290 LET I = 0
300 REM
400 LET A$ = "HELLO, WORLD!"
410 LET B$ = "1234567890"
420 LET C$ = "<>!@$%"
430 LET D$ = "THIS IS A REALLY LONG STRING.  I AM NOT KIDDING.  IT IS REALLY LONG."
440 LET E$ = ""
470 LET S$ = ""
480 LET X$ = ""
490 REM
500 LET ZA = 1024
510 LET ZB = 3000
580 LET Z = 0
590 REM
600 LET FA$ = "STRLEN"
610 LET FB$ = "HELPER1"
620 LET FC$ = "HELPER2"
680 LET F$ = ""
690 REM
700 LET CO = 0
710 LET SU = 0
790 REM
800 LET LB = 0
810 LET LA = 0
890 REM
1000 CLS
1010 S$ = "STRLEN.S TEST SUITE"
1020 GOSUB 3000
1030 S$ = "BY RICHARD CAVELL"
1040 GOSUB 3000
1050 S$ = "(C) 2017"
1060 GOSUB 3000
1070 PRINT
1100 S$ = "HTTPS://GITHUB.COM/"
1110 GOSUB 3000
1120 S$ = "RICHARDCAVELL/6809-STRLEN"
1130 GOSUB 3000
1140 PRINT
1150 S$ = "PLEASE ENSURE THAT THE TEST"
1160 GOSUB 3000
1170 S$ = "SUITE DISK IS IN THE DRIVE"
1180 GOSUB 3000
1190 PRINT
1400 LET F$ = FA$ : GOSUB 4000
1410 LET F$ = FB$ : GOSUB 4000
1420 LET F$ = FC$ : GOSUB 4000
1700 PRINT
1710 S$ = "PRESS ANY KEY TO START"
1720 GOSUB 3000
1800 GOSUB 8100
1890 REM
2000 X$ = A$ : GOSUB 5000
2010 X$ = B$ : GOSUB 5000
2020 X$ = C$ : GOSUB 5000
2030 X$ = D$ : GOSUB 5000
2040 X$ = E$ : GOSUB 5000
2050 REM
2100 LET Z = ZA : GOSUB 6000
2110 GOSUB 8000
2150 LET Z = ZB : GOSUB 6000
2500 PRINT
2510 PRINT "TOTAL SCORE :"
2520 PRINT SU;"OUT OF ";CO
2530 PRINT "  (";
2540 PRINT INT((SU/CO)*100            + 0.5);
2550 PRINT "%)"
2600 PRINT "...FINISHED!"
2610 END
2900 REM
3000 REM PRINT S$,
3010 REM CENTRE-JUSTIFIED
3020 LET I = 32 - LEN(S$)
3030 I = INT(I / 2)
3040 IF I < 1 GOTO 3100
3050 PRINT " ";
3060 I = I - 1
3070 GOTO 3040
3100 PRINT S$
3200 RETURN
3990 REM
4000 REM LOAD MACHINE LANGUAGE
4010 REM  ROUTINE NAMED IN F$
4100 PRINT "   ";
4110 PRINT "LOADING ";
4120 PRINT F$;
4130 FOR I = LEN(F$) TO 10
4140 PRINT ".";
4150 NEXT I
4200 LOADM F$
4210 PRINT " DONE!"
4220 RETURN
5000 REM TEST LENGTH OF X$
5010 CLS
5020 GOSUB 7000
5030 PRINT
5040 PRINT "THE STRING IS : "
5050 PRINT " ";CHR$(34);
5060 PRINT X$;CHR$(34)
5070 PRINT
5080 REM
5100 PRINT "CONSTRUCTING";
5110 PRINT " STRING...";
5120 LET LB = LEN(X$)
5130 IF LB < 1 GOTO 5190
5140 FOR I = 0 TO (LB - 1)
5150 POKE (PS + I),                  ASC(MID$(X$,I + 1,1))
5160 NEXT I
5190 REM
5200 POKE (PS + LB), 0
5210 REM
5220 PRINT "DONE!"
5230 PRINT
5300 PRINT "THE CALCULATED";
5310 PRINT " LENGTH IS : "
5420 PRINT " (BASIC) ";
5430 LET LB = LEN(X$)
5440 PRINT LB
5450 PRINT " (ASM)   ";
5460 GOSUB 10000
5470 PRINT LA
5480 PRINT
5500 IF LA <> LB GOTO 5550
5520 PRINT "TEST PASSED!"
5530 LET SU = SU + 1
5540 GOTO 5600
5550 PRINT "TEST FAILED!"
5600 PRINT
5650 GOSUB 8000
5700 RETURN
6000 REM CREATE AND TEST
6010 REM VERY LONG STRING
6020 REM LENGTH IS IN Z
6050 CLS
6100 GOSUB 7000
6110 S$ = "VERY LONG STRING TEST"
6120 GOSUB 3000
6130 S$ = "(BE PATIENT!)"
6140 GOSUB 3000
6150 PRINT
6160 PRINT "INTENDED";
6170 PRINT " LENGTH : "; Z
6180 PRINT
6200 PRINT "CONSTRUCTING";
6210 PRINT " STRING...";
6250 GOSUB 10500
6290 PRINT "DONE!"
6300 PRINT
6310 PRINT "THE CALCULATED";
6320 PRINT " LENGTH IS : "
6330 PRINT " (BASIC) ";
6400 LET I = PS
6410 IF PEEK(I) = 0 GOTO 6450
6420 LET I = I + 1
6430 GOTO 6410
6450 LET LB = I - PS
6460 PRINT LB
6500 PRINT " (ASM)   ";
6510 GOSUB 10000
6520 PRINT LA
6530 PRINT
6600 IF Z <> LB GOTO 6650
6610 IF Z <> LA GOTO 6650
6620 PRINT "TEST PASSED!"
6630 SU = SU + 1
6640 GOTO 6700
6650 PRINT "TEST FAILED!"
6700 RETURN
7000 REM COUNT THE TESTS
7010 LET CO = CO + 1
7020 S$ = "TEST #" + STR$(CO)
7030 GOSUB 3000
7040 RETURN
8000 REM ASK FOR KEYPRESS
8010 S$ = "PRESS ANY KEY TO CONTINUE"
8020 GOSUB 3000
8030 GOTO 8100
8100 REM WAIT FOR KEYPRESS
8110 IF INKEY$ = "" GOTO 8110
8120 RETURN
10000 REM CALL STRLEN
10010 REM  VIA HELPER
10100 LET I = PM : GOSUB 11000
10110 POKE PA, I
10120 LET I = PM : GOSUB 11100
10130 POKE (PA + 1), I
10200 LET I = PS : GOSUB 11000
10210 POKE PB, I
10220 LET I = PS : GOSUB 11100
10230 POKE (PB + 1), I
10290 REM LET'S DO THIS
10300 EXEC PN
10350 LET LA = PEEK(PL)                 * 256 + PEEK(PL + 1)
10400 RETURN
10500 REM CALL HELPER
10510 REM  TO CONSTRUCT STRING
10520 REM LENGTH IS IN Z
10600 LET I = Z : GOSUB 11000
10620 POKE PP, I
10650 LET I = Z : GOSUB 11100
10670 POKE (PP + 1), I
10700 LET I = PS : GOSUB 11000
10710 POKE PQ, I
10720 LET I = PS : GOSUB 11100
10730 POKE (PQ + 1), I
10790 REM LET'S DO THIS
10800 EXEC PR
10900 RETURN
11000 REM GET HIBYTE OF I
11010 I = INT(I / 256)
11020 RETURN
11100 REM GET LOBYTE OF I
11110 REM UNROLLED FOR SPEED
11200 IF I >= 32768 THEN                I = I - 32768
11210 IF I >= 16384 THEN                I = I - 16384
11220 IF I >= 8192 THEN                 I = I - 8192
11230 IF I >= 4096 THEN                 I = I - 4096
11240 IF I >= 2048 THEN                 I = I - 2048
11250 IF I >= 1024 THEN                 I = I - 1024
11260 IF I >= 512 THEN                  I = I - 512
11270 IF I >= 256 THEN                  I = I - 256
11300 RETURN
