1 GOTO 80
2 I=I+1:IFPEEK(I)THEN2
3 RETURN
70 REM TIME-CRITICAL LOOP
71 REM ABOVE. SEE
72 REM LINE 31200
80 CLS
90 REM
100 REM     TEST.BAS
120 REM
130 REM A PROGRAM TO TEST
140 REM    6809-STRLEN
150 REM
160 REM BY RICHARD JOHN
170 REM  FOSTER CAVELL
180 REM    (C) 2017
190 REM
200 REM HTTPS://GITHUB.COM/
210 REM   RICHARDCAVELL/
220 REM    6809-STRLEN
230 REM
400 REM THIS PROGRAM IS FOR
410 REM  THE TRS-80 COLOR
420 REM     COMPUTER 2
430 REM
600 REM     IT NEEDS
610 REM AT LEAST 16K AND
620 REM   A DISK DRIVE
630 REM
800 PCLEAR 1
810 CLEAR 200, &H2FF0
820 REM
1000 DEFUSR1 = &H3100
1010 DEFUSR2 = &H3180
1100 PS = &H3200
1150 I = 0
1190 REM
1200 A$ = "HELLO, WORLD!"
1210 B$ = "1234567890"
1220 C$ = "<>!@$%"
1230 D$ = ""
1300 E$ = ""
1310 FOR I = 193 TO 220
1320 E$ = E$ + CHR$(I)
1330 NEXT I
1350 G$ = "THIS IS A LONG STRING.  IT IS TOO LONG TO FIT ON ONE LINE."
1400 S$ = ""
1410 X$ = ""
1490 REM
1500 ZA = 1024
1510 ZB = 3000
1580 Z = 0
1590 REM
1600 FA$ = "STRLEN"
1610 FB$ = "NESTRLEN"
1620 FC$ = "HELPER1"
1630 FD$ = "HELPER2"
1680 F$ = ""
1690 REM
2000 CO = 0
2010 CS = 0
2020 A = 0
2090 REM
2200 LB = 0
2210 LA = 0
2290 REM
5000 CLS
5100 S$ = "6809-STRLEN TEST SUITE"
5110 GOSUB 10000
5120 S$ = "BY RICHARD CAVELL"
5150 GOSUB 10000
5160 PRINT
5200 S$ = "HTTPS://GITHUB.COM/"
5210 GOSUB 10000
5220 S$ = "RICHARDCAVELL/6809-STRLEN"
5230 GOSUB 10000
5240 PRINT
5400 S$ = "PLEASE ENSURE THAT THE TEST"
5410 GOSUB 10000
5420 S$ = "SUITE DISK IS IN THE DRIVE"
5430 GOSUB 10000
5500 PRINT
5510 F$ = FA$ : GOSUB 15000
5520 F$ = FB$ : GOSUB 15000
5530 F$ = FC$ : GOSUB 15000
5540 F$ = FD$ : GOSUB 15000
5590 PRINT
5600 S$ = "PRESS ANY KEY TO START"
5610 GOSUB 10000
5700 S$ = "(A FOR AUTORUN)"
5710 GOSUB 11000
5800 GOSUB 14000
5890 REM
6000 X$ = A$ : GOSUB 20000
6010 X$ = B$ : GOSUB 20000
6020 X$ = C$ : GOSUB 20000
6030 X$ = D$ : GOSUB 20000
6040 X$ = E$ : GOSUB 20000
6050 X$ = G$ : GOSUB 20000
6060 REM
6100 Z = ZA : GOSUB 30000
6110 PRINT
6120 GOSUB 12000
6150 Z = ZB : GOSUB 30000
6200 PRINT
7000 PRINT "TOTAL SCORE :"
7020 PRINT CS;"OUT OF ";CO*2
7030 PRINT "  (";
7040 PRINT INT((CS/(CO*2))*100            + 0.5);
7050 PRINT "%)"
7100 PRINT "...FINISHED!"
7200 END
7900 REM
10000 REM ROUTINE QA
10010 REM PRINT S$,
10020 REM  CENTRE-JUSTIFIED
10100 GOSUB 10500
10400 PRINT S$
10410 RETURN
10500 I=(32-LEN(S$))/2:IFI>=1THENPRINTSTRING$(I,32);
10700 RETURN
11000 REM ROUTINE QB
11010 REM PRINT S$,
11020 REM  CENTRE-JUSTIFIED
11030 REM  WITH NO NEWLINE
11100 GOSUB 10500
11200 PRINT S$;
11300 RETURN
12000 REM ROUTINE QC
12010 REM ASK FOR KEYPRESS
12020 REM  THEN WAIT FOR IT
12030 REM  (ONLY IF AUTORUN
12040 REM   IS NOT ON)
12100 IF A = 1 THEN RETURN
12150 S$ = "PRESS ANY KEY TO CONTINUE"
12160 GOSUB 11000
12200 GOTO 13000
12390 REM
13000 REM ROUTINE QD
13010 REM WAIT FOR KEYPRESS
13100 S$ = INKEY$
13110 IF S$ = "" THEN GOTO 13100
13200 RETURN
14000 REM ROUTINE QE
14010 REM WAIT FOR KEYPRESS
14020 REM IF A IS PRESSED,
14030 REM SET A TO 1
14100 GOSUB 13000
14110 IF S$ = "A" THEN A = 1
14200 RETURN
15000 REM ROUTINE QL
15010 REM LOAD MACHINE LANGUAGE
15020 REM  ROUTINE NAMED IN F$
15200 PRINT "   ";
15210 PRINT "LOADING ";
15220 PRINT F$;
15400 FOR I = LEN(F$) TO 10
15410 PRINT ".";
15420 NEXT I
15500 LOADM F$
15610 PRINT " DONE!"
15620 RETURN
20000 REM ROUTINE QM
20010 REM TEST LENGTH OF X$
20100 CLS
20110 GOSUB 40000
20200 PRINT
20210 PRINT "THE STRING IS : "
20220 PRINT " ";CHR$(34);
20230 PRINT X$;CHR$(34)
20240 PRINT
20290 REM
20400 PRINT "CONSTRUCTING";
20410 PRINT " STRING...";
20420 LB = LEN(X$)
20500 IF LB < 1 THEN GOTO 20600
20520 FOR I = 0 TO (LB - 1)
20530 POKE (PS + I),                  ASC(MID$(X$,I + 1,1))
20540 NEXT I
20600 REM
20610 POKE (PS + LB), 0
20700 PRINT "DONE!"
20800 PRINT
21000 PRINT "THE CALCULATED";
21010 PRINT " LENGTH IS : "
21100 PRINT " (BASIC)   ";
21110 PRINT LB
21200 PRINT " (STRLEN)  ";
21210 LA = USR1(0)
21300 GOSUB 50000
22000 PRINT LA;
22010 IF LA <> LB THEN GOTO 22500
22100 PRINT "(TEST PASSED!)"
22200 CS = CS + 1
22210 GOTO 23000
22500 PRINT "(TEST FAILED!)"
23000 PRINT " (NESTRLEN)";
23010 LA = USR1(1)
23020 GOSUB 50000
23100 PRINT LA;
23110 IF LA <> LB THEN GOTO 23500
23200 PRINT "(TEST PASSED!)"
23210 CS = CS + 1
23250 GOTO 23600
23500 PRINT "(TEST FAILED!)"
23600 PRINT
22500 GOSUB 12000
22600 RETURN
30000 REM ROUTINE QN
30010 REM VERY LONG
30020 REM STRING TEST
30030 REM LENGTH IS IN Z
30100 CLS
30200 GOSUB 40000
30300 S$ = "VERY LONG STRING TEST"
30310 GOSUB 10000
30400 S$ = "(BE PATIENT!)"
30410 GOSUB 10000
30420 PRINT
30500 PRINT "INTENDED";
30510 PRINT " LENGTH : "; Z
30520 PRINT
30600 PRINT "CONSTRUCTING";
30610 PRINT " STRING...";
30700 I = USR2(Z)
30800 PRINT "DONE!"
30810 PRINT
31000 PRINT "THE CALCULATED";
31010 PRINT " LENGTH IS : "
31020 PRINT " (BASIC)   ";
31100 I = PS - 1
31200 GOSUB 2
31300 LB = I - PS
31400 PRINT LB
31020 PRINT " (STRLEN)  ";
32000 LA = USR1(0)
32010 GOSUB 50000
32100 PRINT LA;
32200 IF LB <> Z THEN GOTO 33000
32210 IF LA <> Z THEN GOTO 33000
32220 PRINT "(TEST PASSED!)"
32230 CS = CS + 1
32300 PRINT " (NESTRLEN)";
32310 LA = USR1(1)
32320 GOSUB 50000
32330 PRINT LA;
32400 IF LB <> Z THEN GOTO 33200
32410 IF LA <> Z THEN GOTO 33200
32420 PRINT "(TEST PASSED!)"
32430 CS = CS + 1
32500 RETURN
33000 PRINT "(TEST FAILED!)"
33100 GOTO 32300
33200 PRINT "(TEST FAILED!)"
33300 GOTO 32500
40000 REM ROUTINE QQ
40010 REM COUNT THE TESTS
40100 CO = CO + 1
40110 S$ = "TEST #" + STR$(CO)
40120 GOSUB 10000
40200 RETURN
50000 IF LA<>&HFFFF THEN RETURN
50100 PRINT "ERROR!"
50110 PRINT
50120 PRINT "NO-END ERROR DETECTED"
50130 PRINT "IN STRING"
50140 END
