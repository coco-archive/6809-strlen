10 REM       TEST.BAS
20 REM
30 REM  A PROGRAM TO TEST
40 REM       STRLEN.S
50 REM
60 REM   BY RICHARD JOHN
70 REM    FOSTER CAVELL
80 REM      (C) 2017
90 REM
200 REM THIS PROGRAM IS FOR
210 REM  THE TRS-80 COLOR
220 REM COMPUTER 1, 2 OR 3
230 REM
400 REM      IT NEEDS
410 REM  AT LEAST 16K AND
420 REM    A DISK DRIVE
430 REM
800 PCLEAR 1
810 CLEAR 200, &H2FF0
820 REM
1000 LET PA = &H2FFC
1010 LET PB = &H2FFE
1020 LET PL = &H2FFE
1030 LET PM = &H3000
1040 LET PN = &H3100
1050 LET PP = &H317C
1060 LET PQ = &H317E
1070 LET PR = &H3180
1080 LET PS = &H3200
1100 LET I = 0
1110 LET J = 0
1190 REM
1200 LET A$ = "HELLO, WORLD!"
1210 LET B$ = "1234567890"
1220 LET C$ = "<>!@$%"
1230 LET D$ = "THIS IS A REALLY LONG STRING.  I AM NOT KIDDING.  IT IS REALLY LONG."
1240 LET E$ = ""
1270 LET S$ = ""
1280 LET X$ = ""
1290 REM
1400 LET ZA = 1024
1410 LET ZB = 3000
1480 LET Z = 0
1490 REM
1600 LET FA$ = "STRLEN"
1610 LET FB$ = "HELPER1"
1620 LET FC$ = "HELPER2"
1680 LET F$ = ""
1690 REM
2000 LET CO = 0
2010 LET CS = 0
2090 REM
2200 LET LB = 0
2210 LET LA = 0
2290 REM
5000 CLS
5100 S$ = "STRLEN.S TEST SUITE"
5110 GOSUB 10000
5120 S$ = "BY RICHARD CAVELL"
5130 GOSUB 10000
5140 S$ = "(C) 2017"
5150 GOSUB 10000
5160 PRINT
5200 S$ = "HTTPS://GITHUB.COM/"
5210 GOSUB 10000
5220 S$ = "RICHARDCAVELL/6809-STRLEN"
5230 GOSUB 10000
5240 PRINT
5300 S$ = "PLEASE ENSURE THAT THE TEST"
5310 GOSUB 10000
5320 S$ = "SUITE DISK IS IN THE DRIVE"
5330 GOSUB 10000
5390 PRINT
5500 F$ = FA$ : GOSUB 15000
5510 F$ = FB$ : GOSUB 15000
5520 F$ = FC$ : GOSUB 15000
5590 PRINT
5600 S$ = "PRESS ANY KEY TO START"
5610 GOSUB 10000
5620 GOSUB 13000
5690 REM
6000 X$ = A$ : GOSUB 20000
6010 X$ = B$ : GOSUB 20000
6020 X$ = C$ : GOSUB 20000
6030 X$ = D$ : GOSUB 20000
6040 X$ = E$ : GOSUB 20000
6050 REM
6100 Z = ZA : GOSUB 30000
6110 GOSUB 12000
6150 Z = ZB : GOSUB 30000
6200 PRINT
7000 PRINT "TOTAL SCORE :"
7020 PRINT CS;"OUT OF ";CO
7030 PRINT "  (";
7040 PRINT INT((CS/CO)*100            + 0.5);
7050 PRINT "%)"
7100 PRINT "...FINISHED!"
7200 END
7900 REM
10000 REM ROUTINE QA
10010 REM PRINT S$,
10020 REM  CENTRE-JUSTIFIED
10100 I = 32 - LEN(S$)
10110 I = INT(I / 2)
10200 IF I < 1 GOTO 10300
10210 FOR J = 1 TO I
10220 PRINT " ";
10230 NEXT J
10300 REM
10400 PRINT S$
10410 RETURN
10990 REM
12000 REM ROUTINE QC
12010 REM ASK FOR KEYPRESS
12020 REM  THEN WAIT FOR IT
12100 S$ = "PRESS ANY KEY TO CONTINUE"
12110 GOSUB 10000
12200 GOTO 13000
12390 REM
13000 REM ROUTINE QD
13010 REM WAIT FOR KEYPRESS
13100 IF INKEY$ = "" GOTO 13100
13120 RETURN
13190 REM
15000 REM ROUTINE QL
15010 REM LOAD MACHINE LANGUAGE
15020 REM  ROUTINE NAMED IN F$
15200 PRINT "   ";
15210 PRINT "LOADING ";
15220 PRINT F$;
15400 FOR I = LEN(F$) TO 10
15410 PRINT ".";
15420 NEXT I
15600 LOADM F$
15610 PRINT " DONE!"
15620 RETURN
20000 REM ROUTINE QM
20010 REM TEST LENGTH OF X$
20100 CLS
20110 GOSUB 40000
20200 PRINT
20210 PRINT "THE STRING IS : "
20220 PRINT " ";CHR$(34);
20230 PRINT X$;CHR$(34)
20240 PRINT
20290 REM
20400 PRINT "CONSTRUCTING";
20410 PRINT " STRING...";
20420 LB = LEN(X$)
20500 IF LB < 1 GOTO 20600
20520 FOR I = 0 TO (LB - 1)
20530 POKE (PS + I),                  ASC(MID$(X$,I + 1,1))
20540 NEXT I
20600 REM
20610 POKE (PS + LB), 0
20700 PRINT "DONE!"
20800 PRINT
21000 PRINT "THE CALCULATED";
21010 PRINT " LENGTH IS : "
21100 PRINT " (BASIC) ";
21110 PRINT LB
21200 PRINT " (ASM)   ";
21210 GOSUB 50000
22000 PRINT LA
22010 PRINT
22020 Q1 = 23000
22030 IF LA <> LB GOTO Q1
22100 PRINT "TEST PASSED!"
22200 CS = CS + 1
22300 REM
22350 PRINT
22400 REM
22500 GOSUB 12000
22600 RETURN
23000 PRINT "TEST FAILED!"
23010 Q1 = 22300
23020 GOTO Q1
30000 REM ROUTINE QN
30010 REM VERY LONG
30020 REM STRING TEST
30030 REM LENGTH IS IN Z
30100 CLS
30200 GOSUB 40000
30300 S$ = "VERY LONG STRING TEST"
30310 GOSUB 10000
30400 S$ = "(BE PATIENT!)"
30410 GOSUB 10000
30420 PRINT
30500 PRINT "INTENDED";
30510 PRINT " LENGTH : "; Z
30520 PRINT
30600 PRINT "CONSTRUCTING";
30610 PRINT " STRING...";
30700 GOSUB 55000
30800 PRINT "DONE!"
30810 PRINT
31000 PRINT "THE CALCULATED";
31010 PRINT " LENGTH IS : "
31020 PRINT " (BASIC) ";
31100 I = PS - 1
31200 I = I + 1
31210 IF PEEK(I) <> 0 GOTO 31200
31300 LB = I - PS
31400 PRINT LB
31500 PRINT " (ASM)   ";
32000 GOSUB 50000
32010 PRINT LA
32020 PRINT
32200 IF LB <> Z GOTO 33000
32210 IF LA <> Z GOTO 33000
32220 PRINT "TEST PASSED!"
32230 CS = CS + 1
32300 REM
32310 RETURN
33000 PRINT "TEST FAILED!"
33100 GOTO 32310
40000 REM ROUTINE QQ
40010 REM COUNT THE TESTS
40100 CO = CO + 1
40110 S$ = "TEST #" + STR$(CO)
40120 GOSUB 10000
40200 RETURN
50000 REM ROUTINE QS
50010 REM CALL STRLEN
50020 REM  VIA HELPER
50100 I = PM : GOSUB 60000
50110 POKE PA, I
50120 I = PM : GOSUB 61000
50130 POKE (PA + 1), I
50200 I = PS : GOSUB 60000
50210 POKE PB, I
50220 I = PS : GOSUB 61000
50230 POKE (PB + 1), I
50290 REM LET'S DO THIS
50300 EXEC PN
50350 LA = PEEK(PL)                 * 256 + PEEK(PL + 1)
50400 RETURN
55000 REM ROUTINE QT
55010 REM CALL HELPER
55020 REM  TO CONSTRUCT STRING
55030 REM LENGTH IS IN Z
55100 I = Z : GOSUB 60000
55110 POKE PP, I
55120 I = Z : GOSUB 61000
55130 POKE (PP + 1), I
55140 I = PS : GOSUB 60000
55150 POKE PQ, I
55160 I = PS : GOSUB 61000
55170 POKE (PQ + 1), I
55180 REM LET'S DO THIS
55200 EXEC PR
55300 RETURN
60000 REM ROUTINE QX
60010 REM GET HIBYTE OF I
60100 I = INT(I / 256)
60120 RETURN
61000 REM ROUTINE QY
61010 REM GET LOBYTE OF I
61020 REM UNROLLED FOR SPEED
61200 IF I >= 32768 THEN                I = I - 32768
61210 IF I >= 16384 THEN                I = I - 16384
61220 IF I >= 8192 THEN                 I = I - 8192
61230 IF I >= 4096 THEN                 I = I - 4096
61240 IF I >= 2048 THEN                 I = I - 2048
61250 IF I >= 1024 THEN                 I = I - 1024
61260 IF I >= 512 THEN                  I = I - 512
61270 IF I >= 256 THEN                  I = I - 256
61300 RETURN
