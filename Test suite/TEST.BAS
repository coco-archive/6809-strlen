10 REM       TEST.BAS
20 REM
30 REM  A PROGRAM TO TEST
40 REM       STRLEN.S
50 REM
60 REM   BY RICHARD JOHN
70 REM    FOSTER CAVELL
80 REM      (C) 2017
90 REM
100 REM THIS PROGRAM NEEDS
110 REM  AT LEAST 16K AND
120 REM    A DISK DRIVE
130 REM
200 PCLEAR 1
210 CLEAR 200, &H2FF0
220 REM
300 LET PA = &H2FFC
310 LET PB = &H2FFE
320 LET PM = &H3000
330 LET PN = &H3100
340 LET PS = &H3200
350 REM
400 LET A$ = "HELLO, WORLD!"
410 LET B$ = "1234567890"
420 LET C$ = "<>!@$%"
430 LET D$ = "THIS IS A REALLY LONG STRING.  I AM NOT KIDDING.  IT IS REALLY LONG."
440 LET E$ = ""
450 REM
500 LET ZA = 1024
510 LET ZB = 3000
520 REM
600 LET FA$ = "STRLEN"
610 LET FB$ = "HELPER"
620 REM
700 LET CO = 0
710 LET SU = 0
1000 CLS
1010 PRINT "      STRLEN.S TEST SUITE"
1020 PRINT "       BY RICHARD CAVELL"
1030 PRINT "            (C) 2017"
1040 PRINT
1050 PRINT "      HTTPS://GITHUB.COM/"
1060 PRINT "   RICHARDCAVELL/6809-STRLEN"
1070 PRINT
1200 PRINT "     PLEASE ENSURE THAT THE"
1210 PRINT "       TEST SUITE DISK IS"
1220 PRINT "          IN THE DRIVE"
1230 PRINT
1300 PRINT "    ";
1310 PRINT "LOADING ";
1320 PRINT FA$;: PRINT "...";
1350 LOADM FA$
1360 PRINT " DONE!"
1400 PRINT "    ";
1410 PRINT "LOADING ";
1420 PRINT FB$;: PRINT "...";
1450 LOADM FB$
1460 PRINT " DONE!"
1700 PRINT
1710 PRINT "     ";
1720 PRINT "PRESS ANY KEY";
1730 PRINT " TO START"
1740 GOSUB 8100
1750 REM
2000 X$ = A$ : GOSUB 5000
2010 X$ = B$ : GOSUB 5000
2020 X$ = C$ : GOSUB 5000
2030 X$ = D$ : GOSUB 5000
2040 X$ = E$ : GOSUB 5000
2050 REM
2100 LET Z = ZA : GOSUB 6000
2110 GOSUB 8000
2150 LET Z = ZB : GOSUB 6000
3000 PRINT
3010 PRINT "TOTAL SCORE :"
3020 PRINT SU;"OUT OF ";CO
3030 PRINT "  (";
3040 PRINT INT((SU/CO)*100            + 0.5);
3050 PRINT "%)"
3100 PRINT "...FINISHED!"
3110 END
3990 REM
5000 REM TEST LENGTH OF X$
5010 CLS
5020 GOSUB 7000
5030 PRINT
5040 PRINT "THE STRING IS : "
5050 PRINT " ";CHR$(34);
5060 PRINT X$;CHR$(34)
5070 PRINT
5080 REM
5100 PRINT "CONSTRUCTING";
5110 PRINT " STRING...";
5120 LET LN = LEN(X$)
5130 IF LN < 1 GOTO 5190
5140 FOR I = 0 TO (LN - 1)
5150 POKE (PS + I),                  ASC(MID$(X$,I + 1,1))
5160 NEXT I
5190 REM
5200 POKE (PS + LN), 0
5210 REM
5220 PRINT "DONE!"
5230 PRINT
5300 PRINT "THE CALCULATED";
5310 PRINT " LENGTH IS : "
5420 PRINT " (BASIC) ";
5430 LET LN = LEN(X$)
5440 PRINT LN
5450 PRINT " (ASM)   ";
5460 GOSUB 10000
5470 PRINT LA
5480 PRINT
5500 IF LN = LA GOTO 5550
5510 PRINT "TEST FAILED!"
5520 GOTO 5600
5550 PRINT "TEST PASSED!"
5560 SU = SU + 1
5600 PRINT
5650 GOSUB 8000
5700 RETURN
6000 REM CREATE AND TEST
6010 REM VERY LONG STRING
6020 REM LENGTH IS IN Z
6050 CLS
6100 GOSUB 7000
6110 PRINT "     VERY LONG";
6120 PRINT " STRING TEST"
6130 PRINT "         (BE";
6140 PRINT " PATIENT!)"
6150 PRINT
6160 PRINT "INTENDED";
6170 PRINT " LENGTH : "; Z
6180 PRINT
6200 PRINT "CONSTRUCTING";
6210 PRINT " STRING...";
6250 FOR I = (PS) TO                 (PS + Z - 1)
6260 POKE I, ASC("A")
6270 NEXT I
6280 POKE (PS + Z), 0
6290 PRINT "DONE!"
6300 PRINT
6310 PRINT "THE CALCULATED";
6320 PRINT " LENGTH IS : "
6330 PRINT " (BASIC) ";
6400 LET I = PS : LET LN = 0
6410 IF PEEK(I) = 0 GOTO 6450
6420 LET I = I + 1
6430 GOTO 6410
6450 LET LN = I - PS
6460 PRINT LN
6500 PRINT " (ASM)   ";
6510 GOSUB 10000
6520 PRINT LA
6530 PRINT
6600 IF Z <> LA GOTO 6650
6610 IF Z <> LN GOTO 6650
6620 PRINT "TEST PASSED!"
6630 SU = SU + 1
6640 GOTO 6700
6650 PRINT "TEST FAILED!"
6700 RETURN
7000 REM COUNT THE TESTS
7010 LET CO = CO + 1
7020 PRINT "            ";
7030 PRINT "TEST #";CO
7040 RETURN
8000 REM ASK FOR KEYPRESS
8010 PRINT "PRESS ANY KEY";
8020 PRINT " TO CONTINUE";
8030 GOTO 8100
8100 REM WAIT FOR KEYPRESS
8110 IF INKEY$ = "" GOTO 8110
8120 RETURN
10000 REM CALL HELPER ROUTINE
10100 LET I = PM : GOSUB 11000
10110 POKE PA, I
10120 LET I = PM : GOSUB 11100
10130 POKE (PA + 1), I
10200 LET I = PS : GOSUB 11000
10210 POKE PB, I
10220 LET I = PS : GOSUB 11100
10230 POKE (PB + 1), I
10290 REM LET'S DO THIS
10300 EXEC PN
10350 LET LA = PEEK(PB)                 * 256 + PEEK(PB + 1)
10400 RETURN
11000 REM GET HIBYTE OF I
11010 I = INT(I / 256)
11020 RETURN
11100 REM GET LOBYTE OF I
11110 REM UNROLLED FOR SPEED
11200 IF I >= 32768 THEN                I = I - 32768
11210 IF I >= 16384 THEN                I = I - 16384
11220 IF I >= 8192 THEN                 I = I - 8192
11230 IF I >= 4096 THEN                 I = I - 4096
11240 IF I >= 2048 THEN                 I = I - 2048
11250 IF I >= 1024 THEN                 I = I - 1024
11260 IF I >= 512 THEN                  I = I - 512
11270 IF I >= 256 THEN                  I = I - 256
11300 RETURN
