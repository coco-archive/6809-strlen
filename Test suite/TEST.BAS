1 GOTO 50
2 I=I+1:IFPEEK(I)THEN2
3 RETURN
4 IFINKEY$=""THEN4
5 RETURN
6 S$=INKEY$:IFS$=""THEN6
7 RETURN
10 REM TIME-CRITICAL LOOPS
20 REM  ABOVE
50 PCLEAR 1
60 CLEAR 255, &H2FFF
80 CLS
100 REM     TEST.BAS
110 REM
120 REM A PROGRAM TO TEST
130 REM    6809-STRLEN
140 REM
200 REM BY RICHARD JOHN
210 REM  FOSTER CAVELL
220 REM    (C) 2017
230 REM
300 REM HTTPS://GITHUB.COM/
310 REM   RICHARDCAVELL/
320 REM     6809-STRLEN
330 REM
400 REM THIS PROGRAM IS FOR
410 REM AN EMULATED TRS-80
420 REM  COLOR COMPUTER 2
430 REM  RUNNING IN XROAR
440 REM       OR MAME
450 REM
500 REM     IT NEEDS
510 REM AT LEAST 16K AND
520 REM   AN EMULATED
530 REM    DISK DRIVE
540 REM
800 DEFUSR1 = &H3100
810 DEFUSR2 = &H3180
900 PS = &H3200
950 I = 0
1000 A$ = "HELLO, WORLD!"
1010 B$ = "1234567890"
1020 C$ = "<>!@$%"
1030 D$ = ""
1050 E$ = ""
1060 FOR I = 193 TO 220
1070 E$ = E$ + CHR$(I)
1080 NEXT I
1100 F$ = "THIS IS A LONG STRING.  IT IS TOO LONG TO FIT ON ONE LINE."
1150 S$ = ""
1160 X$ = ""
1200 ZA = 1024
1210 ZB = 3000
1250 Z = 0
1300 FA$ = "STRLEN"
1310 FB$ = "NESTRLEN"
1320 FC$ = "HELPER1"
1330 FD$ = "HELPER2"
1350 FI$ = ""
1400 A = 0
1450 CO = 0
1460 CS = 0
1500 LB = 0
1510 LA = 0
2000 CLS
2100 S$ = "6809-STRLEN TEST SUITE"
2110 GOSUB 5000
2150 S$ = "BY RICHARD CAVELL"
2160 GOSUB 5000
2170 PRINT
2200 S$ = "HTTPS://GITHUB.COM/"
2210 GOSUB 5000
2250 S$ = "RICHARDCAVELL/6809-STRLEN"
2260 GOSUB 5000
2270 PRINT
2300 S$ = "PLEASE ENSURE THAT THE TEST"
2310 GOSUB 5000
2350 S$ = "SUITE DISK IS IN THE DRIVE"
2360 GOSUB 5000
2370 PRINT
2510 FI$ = FA$ : GOSUB 7000
2520 FI$ = FB$ : GOSUB 7000
2530 FI$ = FC$ : GOSUB 7000
2540 FI$ = FD$ : GOSUB 7000
2550 PRINT
2600 S$ = "PRESS ANY KEY TO START"
2610 GOSUB 5000
2650 S$ = "(A FOR AUTORUN)"
2660 GOSUB 5500
2700 GOSUB 6700
3000 X$ = A$ : GOSUB 20000
3010 X$ = B$ : GOSUB 20000
3020 X$ = C$ : GOSUB 20000
3030 X$ = D$ : GOSUB 20000
3040 X$ = E$ : GOSUB 20000
3050 X$ = F$ : GOSUB 20000
3200 Z = ZA : GOSUB 30000
3210 GOSUB 6000
3250 Z = ZB : GOSUB 30000
3400 CO = CO * 2
3410 PRINT "TOTAL SCORE :"
3420 PRINT CS;"OUT OF ";CO
3430 PRINT "  (";
3440 PRINT INT((CS/CO)*100 + 0.5);
3450 PRINT "%)"
3460 PRINT "...FINISHED!"
3500 END
5000 REM PRINT S$,
5010 REM  CENTRE-JUSTIFIED
5100 GOSUB 5800
5110 PRINT S$
5120 RETURN
5500 REM PRINT S$,
5510 REM  CENTRE-JUSTIFIED
5520 REM  WITH NO NEWLINE
5600 GOSUB 5800
5610 PRINT S$;
5620 RETURN
5800 I=(32-LEN(S$))/2:IFI>=1THENPRINTSTRING$(I,32);
5810 RETURN
6000 REM IF AUTORUN IS NOT
6010 REM  ON, ASK FOR
6020 REM  KEYPRESS, THEN
6030 REM  WAIT FOR IT
6100 IF A = 1 THEN RETURN
6150 S$ = "PRESS ANY KEY TO CONTINUE"
6160 GOSUB 5500
6200 GOTO 6500
6500 REM WAIT FOR KEYPRESS
6510 REM  IGNORE THE KEY
6600 GOTO 4
6700 REM WAIT FOR KEYPRESS
6710 REM  IF A IS PRESSED,
6720 REM  SET A TO 1
6800 GOSUB 6
6810 IF S$ = "A" THEN A = 1
6850 RETURN
7000 REM LOAD MACHINE
7010 REM  LANGUAGE ROUTINE
7020 REM  NAMED IN FI$
7100 PRINT "   ";
7110 PRINT "LOADING "; FI$;
7150 FOR I = LEN(FI$) TO 10
7160 PRINT ".";
7170 NEXT I
7200 LOADM FI$
7210 PRINT " DONE!"
7220 RETURN
20000 REM TEST LENGTH OF X$
20100 CLS
20110 GOSUB 40000
20200 PRINT
20210 PRINT "THE STRING IS : "
20220 PRINT " ";CHR$(34);
20230 PRINT X$;CHR$(34)
20240 PRINT
20290 REM
20400 PRINT "CONSTRUCTING";
20410 PRINT " STRING...";
20420 LB = LEN(X$)
20500 IF LB < 1 THEN GOTO 20600
20520 FOR I = 0 TO (LB - 1)
20530 POKE (PS + I),                  ASC(MID$(X$,I + 1,1))
20540 NEXT I
20600 REM
20610 POKE (PS + LB), 0
20700 PRINT "DONE!"
20800 PRINT
21000 PRINT "THE MEASURED";
21010 PRINT " LENGTH IS : "
21100 PRINT " (BASIC)   ";
21110 PRINT LB
21200 PRINT " (STRLEN)  ";
21210 LA = USR1(0)
21300 GOSUB 50000
22000 PRINT LA;
22010 IF LA <> LB THEN GOTO 22500
22100 PRINT "(TEST PASSED!)"
22200 CS = CS + 1
22210 GOTO 23000
22500 PRINT "(TEST FAILED!)"
23000 PRINT " (NESTRLEN)";
23010 LA = USR1(1)
23020 GOSUB 50000
23100 PRINT LA;
23110 IF LA <> LB THEN GOTO 23500
23200 PRINT "(TEST PASSED!)"
23210 CS = CS + 1
23250 GOTO 23600
23500 PRINT "(TEST FAILED!)"
23600 PRINT
22500 GOSUB 6000
22600 RETURN
30000 REM ROUTINE QN
30010 REM VERY LONG
30020 REM STRING TEST
30030 REM LENGTH IS IN Z
30100 CLS
30200 GOSUB 40000
30300 S$ = "VERY LONG STRING TEST"
30310 GOSUB 5000
30400 S$ = "(BE PATIENT!)"
30410 GOSUB 5000
30420 PRINT
30500 PRINT "INTENDED";
30510 PRINT " LENGTH :"; Z
30520 PRINT
30600 PRINT "CONSTRUCTING";
30610 PRINT " STRING...";
30700 I = USR2(Z)
30800 PRINT "DONE!"
30810 PRINT
31000 PRINT "THE CALCULATED";
31010 PRINT " LENGTH IS : "
31020 PRINT " (BASIC)   ";
31100 I = PS - 1
31200 GOSUB 2
31300 LB = I - PS
31400 PRINT LB
31020 PRINT " (STRLEN)  ";
32000 LA = USR1(0)
32010 GOSUB 50000
32100 PRINT LA;
32200 IF LB <> Z THEN GOTO 33000
32210 IF LA <> Z THEN GOTO 33000
32220 PRINT "(TEST PASSED!)"
32230 CS = CS + 1
32300 PRINT " (NESTRLEN)";
32310 LA = USR1(1)
32320 GOSUB 50000
32330 PRINT LA;
32400 IF LB <> Z THEN GOTO 33200
32410 IF LA <> Z THEN GOTO 33200
32420 PRINT "(TEST PASSED!)"
32430 CS = CS + 1
32500 PRINT
32550 RETURN
33000 PRINT "(TEST FAILED!)"
33100 GOTO 32300
33200 PRINT "(TEST FAILED!)"
33300 GOTO 32500
40000 REM ROUTINE QQ
40010 REM COUNT THE TESTS
40100 CO = CO + 1
40110 S$ = "TEST #" + STR$(CO)
40120 GOSUB 5000
40200 RETURN
50000 IF LA<>&HFFFF THEN RETURN
50100 PRINT "ERROR!"
50110 PRINT
50120 PRINT "NO-END ERROR DETECTED"
50130 PRINT "IN STRING"
50140 END
