1 GOTO 10
2 I=I+1:IFPEEK(I)THEN2
3 RETURN
4 IFINKEY$=""THEN4
5 RETURN
6 S$=INKEY$:IFS$=""THEN6
7 RETURN
10 PCLEAR 1
20 CLEAR 255, &H5FFF
30 GOSUB 20000
40 REM TIME-CRITICAL CODE
50 REM  ABOVE
60 REM
100 REM     TEST.BAS
110 REM
120 REM A PROGRAM TO TEST
130 REM    6809-STRLEN
140 REM
200 REM BY RICHARD JOHN
210 REM  FOSTER CAVELL
220 REM    (C) 2017
230 REM
300 REM HTTPS://GITHUB.COM/
310 REM   RICHARDCAVELL/
320 REM     6809-STRLEN
330 REM
400 REM THIS PROGRAM IS FOR
410 REM AN EMULATED TRS-80
420 REM  COLOR COMPUTER 2
430 REM WITH DISK EXTENDED
440 REM    COLOR BASIC
450 REM  RUNNING IN XROAR
460 REM      OR MAME
470 REM
500 REM     IT NEEDS
510 REM AT LEAST 32K AND
520 REM   AN EMULATED
530 REM    DISK DRIVE
540 REM
800 REM INITIAL SETUP
810 LN$ = "E"
1000 REM SETUP USER EXPERIENCE
1100 US = &H6000
1110 DEFUSR1 = US + &H100
1120 DEFUSR2 = US + &H180
1130 PS = US + &H200
1200 FA$ = "STRLEN"
1210 FB$ = "NESTRLEN"
1220 FC$ = "HELPER1"
1230 FD$ = "HELPER2"
1240 FI$ = ""
1300 A$ = "HELLO, WORLD!"
1310 B$ = "1234567890"
1320 C$ = "<>!@$%"
1330 D$ = ""
1340 E$ = ""
1400 I = 0
1410 FOR I = 193 TO 220
1420 E$ = E$ + CHR$(I)
1430 NEXT I
1450 F$ = "THIS IS A LONG STRING.  IT IS TOO LONG TO FIT ON ONE LINE."
1500 A = 1024
1510 B = 3000
1600 X$ = ""
1610 X = 0
1700 S$ = ""
1720 SE$ = ""
1730 SD$ = ""
1800 AR = 0
1820 CT = 0
1830 CI = 0
1840 CS = 0
1900 LA = 0
1910 L = 0
1950 Y = 0
1960 Z = 0
1970 I = 0
2000 REM BEGIN USER EXPERIENCE
2010 REM TITLE SCREEN
2100 SE$ = "6809-STRLEN TEST SUITE"
2110 SD$ = "6809-STRLEN TESTLAUF"
2120 GOSUB 30000
2200 SE$ = "BY RICHARD CAVELL"
2210 SD$ = "VON RICHARD CAVELL"
2220 GOSUB 30000
2300 GOSUB 21000
2400 S$ = "HTTPS://GITHUB.COM/"
2410 GOSUB 26000
2500 S$ = "RICHARDCAVELL/6809-STRLEN"
2510 GOSUB 26000
2580 GOSUB 21000
2600 S$ = "E = ENGLISH"
2610 GOSUB 22000
2620 S$ = "D = DEUTSCH"
2630 GOSUB 22000
2800 GOSUB 21000
3000 SE$ = "PRESS SPACE TO START"
3010 SD$ = "PRESSE LEERTASTE ZU STARTEN"
3020 GOSUB 30000
3100 GOSUB 21000
3200 SE$ = "(A FOR AUTORUN)"
3210 SD$ = "A FUER AUTORUN"
3220 GOSUB 30000
3500 GOSUB 6
3510 IF S$ = "A" THEN GOTO 3900
3520 IF S$ = " " THEN GOTO 4000
3550 IF S$ = "E" THEN GOTO 3800
3560 IF S$ = "D" THEN GOTO 3800
3700 GOTO 3500
3800 IF S$ = LN$ THEN GOTO 3500
3810 LN$ = S$
3820 GOSUB 20000
3830 GOTO 2000
3900 AR = 1
3910 REM FALL-THROUGH
3920 REM
4000 REM SECOND PAGE
4010 GOSUB 20000
4020 GOSUB 21000
4100 SE$ = "PLEASE ENSURE THAT THE TEST"
4110 SD$ = "BITTE STELLEN SIE SICHER,"
4120 GOSUB 30000
4200 SE$ = "SUITE DISK IS IN THE DRIVE"
4210 SD$ = "DASS DIE TESTFOLGEN-DISK"
4220 GOSUB 30000
4300 SE$ = ""
4310 SD$ = "IM LAUFWERK IST"
4320 GOSUB 30000
4500 GOSUB 21000
4600 FI$ = FA$ : GOSUB 40000
4610 FI$ = FB$ : GOSUB 40000
4620 FI$ = FC$ : GOSUB 40000
4630 FI$ = FD$ : GOSUB 40000
5000 REM TEST STRINGS
5010 Z = 0
5020 X$ = A$ : GOSUB 10000
5030 X$ = B$ : GOSUB 10000
5040 X$ = C$ : GOSUB 10000
5050 X$ = D$ : GOSUB 10000
5060 X$ = E$ : GOSUB 10000
5070 X$ = F$ : GOSUB 10000
5200 REM TEST VERY LONG STRINGS
5210 Z = 1
5220 X = A : GOSUB 10000
5230 X = B : GOSUB 10000
5500 REM PRINT RESULTS
5550 GOSUB 20000
5600 SE$ = "6809-STRLEN TEST SUITE"
5610 SD$ = "6809-STRLEN TESTLAUF"
5620 GOSUB 30000
5700 SE$ = "TOTAL SCORE"
5710 SD$ = "PUNKTE INSGESAMT"
5720 GOSUB 30000
5800 GOSUB 21000
5900 S$ = STR$(CI) + " ("
5910 S$ = S$ + STR$(INT((CS/CI)*100 + 0.5))
5920 S$ = S$ + "% )"
6000 SE$ = STR$(CS) + " OUT OF" + S$
6010 SD$ = STR$(CS) + " VON" + S$
6050 GOSUB 30000
6100 GOSUB 21000
6200 SE$ = "FINISHED!"
6210 SD$ = "FERTIGGESTELLT!"
6220 GOSUB 28000
6200 END
10000 REM TEST LENGTH OF STRING
10100 GOSUB 20000
10110 GOSUB 42000
10120 IF Z = 1 THEN GOTO 10400
10200 GOSUB 21000
10210 SE$ = "THE STRING IS : "
10220 SD$ = "DER STRING IST : "
10230 GOSUB 28000
10240 PRINT " ";CHR$(34);
10250 PRINT X$;CHR$(34)
10260 GOSUB 21000
10270 GOTO 10800
10400 SE$ = "VERY LONG STRING TEST"
10410 SD$ = "SEHR LANGER STRING TEST"
10420 GOSUB 30000
10500 SE$ = "BE PATIENT!"
10560 SD$ = "HABEN SIE GEDULD!"
10570 GOSUB 30000
10580 GOSUB 21000
10700 SE$ = "INTENDED LENGTH : " + STR$(X)
10710 SD$ = "VORGESEHENE LAENGE : " + STR$(X)
10720 GOSUB 28000
10730 GOSUB 21000
10800 SE$ = "CONSTRUCTING STRING..."
10810 SD$ = "KONSTRUIERE STRING..."
10820 GOSUB 29000
10850 IF Z = 1 THEN GOTO 11000
10900 LA = LEN(X$)
10910 IF LA < 1 THEN GOTO 10950
10920 FOR I = 0 TO (LA - 1)
10930 POKE (PS + I), ASC(MID$(X$,I + 1,1))
10940 NEXT I
10950 POKE (PS + LA), 0
10960 GOTO 11100
11000 I = USR2(X)
11010 LA = X
11100 SE$ = "DONE!"
11110 SD$ = "FERTIG!"
11120 GOSUB 28000
11200 GOSUB 21000
12000 SE$ = "THE MEASURED LENGTH IS : "
12010 SD$ = "DIE GEMESSENE LAENGE IST : "
12020 GOSUB 28000
12030 IF Z = 1 THEN GOTO 12200
12100 PRINT " (BASIC AUTO)  ";
12110 GOSUB 43000
12120 PRINT LA
12200 PRINT " (BASIC MANUAL)";
12210 GOSUB 44000
12220 PRINT L;
12230 GOSUB 18000
12300 PRINT " (STRLEN)      ";
12310 GOSUB 45000
12320 PRINT L;
12330 GOSUB 19000
12400 PRINT " (NESTRLEN)    ";
12410 GOSUB 46000
12420 PRINT L;
12430 GOSUB 19000
12500 GOSUB 41000
13000 RETURN
18000 IF L <> LA THEN GOTO 18500
18100 SE$ = "(MATCH)"
18110 SD$ = "(GLEICH)"
18120 GOSUB 28000
18200 RETURN
18500 SE$ = "(ERROR!)"
18510 SD$ = "(FEHLER!)"
18520 GOSUB 28000
18530 GOSUB 21000
18600 SE$ = "THERE IS AN INTERNAL ERROR"
18610 SD$ = "ES IST EIN INTERNER FEHLER"
18620 GOSUB 28000
18700 END
19000 IF L <> LA THEN GOTO 19500
19100 CS = CS + 1
19200 SE$ = "(PASS)"
19210 SD$ = "(PASS)"
19220 GOSUB 28000
19300 RETURN
19500 SE$ = "(FAIL!)"
19510 SD$ = "(FEHL!)"
19520 GOSUB 28000
19600 RETURN
20000 REM CLEAR SCREEN
20100 CLS
20200 RETURN
21000 REM PRINT BLANK LINE
21100 PRINT
21200 RETURN
22000 REM PRINT S$, INDENTED
22100 PRINT "          ";S$
22200 RETURN
23000 REM PRINT S$, INDENTED
23010 REM  WITH NO NEWLINE
23100 PRINT "          ";S$;
23200 RETURN
25000 REM CHOOSE S$ BASED
25010 REM  ON LANGUAGE
25100 IF LN$ = "E" THEN S$ = SE$
25110 IF LN$ = "D" THEN S$ = SD$
25200 RETURN
26000 REM PRINT S$, CENTRE-JUSTIFIED
26100 GOSUB 32000
26200 PRINT S$
26300 RETURN
27000 REM PRINT S$, CENTRE-JUSTIFIED
27010 REM  WITH NO NEWLINE
27100 GOSUB 32000
27200 PRINT S$;
27300 RETURN
28000 REM PRINT SE$/SD$
28010 REM  BASED ON LANGUAGE
28100 GOSUB 25000
28200 PRINT S$
28300 RETURN
29000 REM PRINT SE$/SD$
29010 REM  BASED ON LANGUAGE
29020 REM  WITH NO NEWLINE
29100 GOSUB 25000
29200 PRINT S$;
29300 RETURN
30000 REM PRINT SE$/SD$
30010 REM CENTRE-JUSTIFIED
30020 REM IF NOT BLANK
30100 GOSUB 25000
30150 GOSUB 32000
30200 IF S$ <> "" THEN PRINT S$
30300 RETURN
31000 REM PRINT SE$/SD$
31010 REM CENTRE-JUSTIFIED
31020 REM IF NOT BLANK
31030 REM NO NEWLINE
31100 GOSUB 25000
31150 GOSUB 32000
31200 IF S$ <> "" THEN PRINT S$;
31300 RETURN
32000 I=(32-LEN(S$))/2:IFI>=1THENPRINTSTRING$(INT(I),32);
32100 RETURN
40000 REM LOAD MACHINE
40010 REM  LANGUAGE ROUTINE
40020 REM  NAMED IN FI$
40100 SE$ = "   LOADING "
40110 SD$ = "   LADE "
40120 GOSUB 29000
40200 PRINT FI$;
40210 FOR I = LEN(FI$) TO 10
40220 PRINT ".";
40230 NEXT I
40300 LOADM FI$
40400 SE$ = " DONE!"
40410 SD$ = " FERTIG!"
40420 GOSUB 28000
40500 RETURN
41000 REM IF AUTORUN IS NOT
41010 REM  ON, ASK FOR
41020 REM  KEYPRESS, THEN
41030 REM  WAIT FOR IT
41100 IF AR = 1 THEN RETURN
41150 GOSUB 21000
41200 SE$ = "PRESS ANY KEY TO CONTINUE"
41210 SD$ = "DRUECKEN SIE EINE BELIEBIGE"
41220 GOSUB 30000
41300 SE$ = ""
41310 SD$ = "TASTE UM FORTZUFAHREN"
41320 GOSUB 31000
41400 GOTO 4
42000 REM COUNT THE TESTS
42100 CT = CT + 1
42200 SE$ = "TEST #" + STR$(CT)
42210 SD$ = "TEST #" + STR$(CT)
42220 GOSUB 30000
42300 RETURN
43000 REM MEASURE X$
43010 REM  USING BASIC
43100 LA = LEN(X$)
43200 RETURN
44000 REM MEASURE STRING
44010 REM LENGTH USING BASIC
44100 I = PS - 1
44110 GOSUB 2
44120 L = I - PS
44200 RETURN
45000 REM MEASURE STRING
45010 REM LENGTH USING STRLEN
45110 Y = 0
45200 GOTO 47000
46000 REM MEASURE STRING
46010 REM LENGTH USING NESTRLEN
46110 Y = 1
46200 GOTO 47000
47000 REM MEASURE STRING
47010 REM  LENGTH USING STRLEN
47020 REM  OR NESTRLEN
47100 CI = CI + 1
47110 L = USR1(Y)
47200 IF L <> &HFFFF THEN RETURN
47300 SE$ = " ERROR!"
47310 SD$ = " FEHLER!"
47320 GOSUB 28000
47350 GOSUB 21000
47400 SE$ = "NO-END ERROR RETURNED"
47410 SD$ = "ENDLOSFEHLER WURDE"
47420 GOSUB 28000
47450 IF Y = 0 THEN GOTO 47600
47500 SE$ = "BY NESTRLEN"
47510 SD$ = "VON NESTRLEN WIEDERGEGEBEN"
47520 GOSUB 28000
47600 SE$ = "THIS SHOULD NOT BE POSSIBLE"
47610 SD$ = "DIES SOLLTE NICHT MOGLICH SEIN"
47620 GOSUB 28000
47700 END

