1 GOTO 50
2 I=I+1:IFPEEK(I)THEN2
3 RETURN
4 IFINKEY$=""THEN4
5 RETURN
6 S$=INKEY$:IFS$=""THEN6
7 RETURN
10 REM TIME-CRITICAL LOOPS
20 REM  ABOVE
50 PCLEAR 1
60 CLEAR 255, &H2FFF
80 CLS
100 REM     TEST.BAS
110 REM
120 REM A PROGRAM TO TEST
130 REM    6809-STRLEN
140 REM
200 REM BY RICHARD JOHN
210 REM  FOSTER CAVELL
220 REM    (C) 2017
230 REM
300 REM HTTPS://GITHUB.COM/
310 REM   RICHARDCAVELL/
320 REM     6809-STRLEN
330 REM
400 REM THIS PROGRAM IS FOR
410 REM AN EMULATED TRS-80
420 REM  COLOR COMPUTER 2
430 REM  RUNNING IN XROAR
440 REM       OR MAME
450 REM
500 REM     IT NEEDS
510 REM AT LEAST 16K AND
520 REM   AN EMULATED
530 REM    DISK DRIVE
540 REM
800 DEFUSR1 = &H3100
810 DEFUSR2 = &H3180
900 PS = &H3200
950 I = 0
1000 A$ = "HELLO, WORLD!"
1010 B$ = "1234567890"
1020 C$ = "<>!@$%"
1030 D$ = ""
1050 E$ = ""
1060 FOR I = 193 TO 220
1070 E$ = E$ + CHR$(I)
1080 NEXT I
1100 F$ = "THIS IS A LONG STRING.  IT IS TOO LONG TO FIT ON ONE LINE."
1150 S$ = ""
1160 X$ = ""
1200 ZA = 1024
1210 ZB = 3000
1250 Z = 0
1300 FA$ = "STRLEN"
1310 FB$ = "NESTRLEN"
1320 FC$ = "HELPER1"
1330 FD$ = "HELPER2"
1350 FI$ = ""
1400 A = 0
1450 CO = 0
1460 CS = 0
1500 LB = 0
1510 LA = 0
2000 CLS
2100 S$ = "6809-STRLEN TEST SUITE"
2110 GOSUB 5000
2150 S$ = "BY RICHARD CAVELL"
2160 GOSUB 5000
2170 PRINT
2200 S$ = "HTTPS://GITHUB.COM/"
2210 GOSUB 5000
2250 S$ = "RICHARDCAVELL/6809-STRLEN"
2260 GOSUB 5000
2270 PRINT
2300 S$ = "PLEASE ENSURE THAT THE TEST"
2310 GOSUB 5000
2350 S$ = "SUITE DISK IS IN THE DRIVE"
2360 GOSUB 5000
2370 PRINT
2510 FI$ = FA$ : GOSUB 7000
2520 FI$ = FB$ : GOSUB 7000
2530 FI$ = FC$ : GOSUB 7000
2540 FI$ = FD$ : GOSUB 7000
2550 PRINT
2600 S$ = "PRESS ANY KEY TO START"
2610 GOSUB 5000
2650 S$ = "(A FOR AUTORUN)"
2660 GOSUB 5500
2700 GOSUB 6700
3000 X$ = A$ : GOSUB 10000
3010 X$ = B$ : GOSUB 10000
3020 X$ = C$ : GOSUB 10000
3030 X$ = D$ : GOSUB 10000
3040 X$ = E$ : GOSUB 10000
3050 X$ = F$ : GOSUB 10000
3200 Z = ZA : GOSUB 20000
3210 GOSUB 6000
3250 Z = ZB : GOSUB 20000
3400 CO = CO * 2
3410 PRINT "TOTAL SCORE :"
3420 PRINT CS;"OUT OF ";CO
3430 PRINT "  (";
3440 PRINT INT((CS/CO)*100 + 0.5);
3450 PRINT "%)"
3460 PRINT "...FINISHED!"
3500 END
5000 REM PRINT S$,
5010 REM  CENTRE-JUSTIFIED
5100 GOSUB 5800
5110 PRINT S$
5120 RETURN
5500 REM PRINT S$,
5510 REM  CENTRE-JUSTIFIED
5520 REM  WITH NO NEWLINE
5600 GOSUB 5800
5610 PRINT S$;
5620 RETURN
5800 I=(32-LEN(S$))/2:IFI>=1THENPRINTSTRING$(I,32);
5810 RETURN
6000 REM IF AUTORUN IS NOT
6010 REM  ON, ASK FOR
6020 REM  KEYPRESS, THEN
6030 REM  WAIT FOR IT
6100 IF A = 1 THEN RETURN
6150 S$ = "PRESS ANY KEY TO CONTINUE"
6160 GOSUB 5500
6200 GOTO 6500
6500 REM WAIT FOR KEYPRESS
6510 REM  IGNORE THE KEY
6600 GOTO 4
6700 REM WAIT FOR KEYPRESS
6710 REM  IF A IS PRESSED,
6720 REM  SET A TO 1
6800 GOSUB 6
6810 IF S$ = "A" THEN A = 1
6850 RETURN
7000 REM LOAD MACHINE
7010 REM  LANGUAGE ROUTINE
7020 REM  NAMED IN FI$
7100 PRINT "   ";
7110 PRINT "LOADING "; FI$;
7150 FOR I = LEN(FI$) TO 10
7160 PRINT ".";
7170 NEXT I
7200 LOADM FI$
7210 PRINT " DONE!"
7220 RETURN
8000 REM COUNT THE TESTS
8010 CO = CO + 1
8020 S$ = "TEST #" + STR$(CO)
8030 GOSUB 5000
8050 RETURN
9000 REM MEASURE STRING
9010 REM LENGTH USING BASIC
9020 I = PS - 1
9030 GOSUB 2
9040 LB = I - PS
9050 RETURN
9200 REM MEASURE STRING
9210 REM LENGTH USING STRLEN
9220 LA = USR1(0)
9230 IF LA<>&HFFFF THEN RETURN
9300 PRINT "ERROR!"
9310 PRINT
9320 PRINT "NO-END ERROR DETECTED"
9330 PRINT "IN STRING"
9340 END
9400 REM MEASURE STRING
9410 REM LENGTH USING NESTRLEN
9420 LA = USR1(1)
9430 IF LA<>&HFFFF THEN RETURN
9500 PRINT "ERROR!"
9510 PRINT
9520 PRINT "NO-END ERROR RETURNED"
9530 PRINT "BY NESTRLEN"
9540 PRINT "THIS SHOULD NOT BE POSSIBLE"
9550 END
10000 REM TEST LENGTH OF X$
10100 CLS
10110 GOSUB 8000
10120 PRINT
10210 PRINT "THE STRING IS : "
10220 PRINT " ";CHR$(34);
10230 PRINT X$;CHR$(34)
10240 PRINT
10300 PRINT "CONSTRUCTING";
10310 PRINT " STRING...";
10320 LB = LEN(X$)
10300 IF LB < 1 THEN GOTO 10400
10310 FOR I = 0 TO (LB - 1)
10320 POKE (PS + I), ASC(MID$(X$,I + 1,1))
10330 NEXT I
10400 POKE (PS + LB), 0
10410 PRINT "DONE!"
10420 PRINT
10500 PRINT "THE MEASURED";
10510 PRINT " LENGTH IS : "
10520 PRINT " (BASIC)   ";
10600 GOSUB 9000
10610 PRINT LB
10700 PRINT " (STRLEN)  ";
10710 GOSUB 9200
10720 PRINT LA;
10800 IF LA <> LB THEN GOTO 11500
11000 PRINT "(TEST PASSED!)"
11010 CS = CS + 1
11020 GOTO 12000
11500 PRINT "(TEST FAILED!)"
12000 PRINT " (NESTRLEN)";
12010 GOSUB 9400
12020 PRINT LA;
12030 IF LA <> LB THEN GOTO 12500
12040 PRINT "(TEST PASSED!)"
12050 CS = CS + 1
12060 GOTO 13000
12500 PRINT "(TEST FAILED!)"
13000 PRINT
13010 GOSUB 6000
13020 RETURN
20000 REM VERY LONG
20010 REM  STRING TEST
20020 REM  LENGTH IS IN Z
20050 CLS
20100 GOSUB 8000
20150 S$ = "VERY LONG STRING TEST"
20160 GOSUB 5000
20200 S$ = "(BE PATIENT!)"
20210 GOSUB 5000
20220 PRINT
20300 PRINT "INTENDED";
20310 PRINT " LENGTH :"; Z
20320 PRINT
20400 PRINT "CONSTRUCTING";
20410 PRINT " STRING...";
20500 I = USR2(Z)
20510 PRINT "DONE!"
20520 PRINT
20600 PRINT "THE MEASURED";
20610 PRINT " LENGTH IS : "
20620 PRINT " (BASIC)   ";
20700 GOSUB 9000
20710 PRINT LB
20720 PRINT " (STRLEN)  ";
20730 GOSUB 9200
20700 PRINT LA;
20800 IF LB <> Z THEN GOTO 22000
20810 IF LA <> Z THEN GOTO 22000
20900 PRINT "(TEST PASSED!)"
20910 CS = CS + 1
21000 PRINT " (NESTRLEN)";
21010 GOSUB 9400
21020 PRINT LA;
21400 IF LB <> Z THEN GOTO 23000
21410 IF LA <> Z THEN GOTO 23000
21420 PRINT "(TEST PASSED!)"
21430 CS = CS + 1
21500 PRINT
21550 RETURN
22000 PRINT "(TEST FAILED!)"
22100 GOTO 21000
23000 PRINT "(TEST FAILED!)"
23010 GOTO 21500
